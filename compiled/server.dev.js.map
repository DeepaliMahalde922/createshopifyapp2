{"version":3,"sources":["webpack:///webpack/bootstrap 039c469dfa172bfdb302","webpack:///./server/config/index.js","webpack:///external \"winston\"","webpack:///external \"express\"","webpack:///external \"express-session\"","webpack:///./server/db/index.js","webpack:///./server/db/models/index.js","webpack:///external \"bluebird\"","webpack:///external \"pg-promise\"","webpack:///./server/server.js","webpack:///external \"http\"","webpack:///./server/app.js","webpack:///external \"path\"","webpack:///external \"cookie-parser\"","webpack:///external \"body-parser\"","webpack:///external \"express-flash\"","webpack:///external \"fs\"","webpack:///external \"method-override\"","webpack:///external \"compression\"","webpack:///external \"helmet\"","webpack:///external \"morgan\"","webpack:///external \"serialize-javascript\"","webpack:///./server/db/connect.js","webpack:///external \"sequelize\"","webpack:///./server/db/sequelize_config.json","webpack:///./server/db/models/shop.js","webpack:///./server/db/session.js","webpack:///external \"connect-redis\"","webpack:///./server/routes/shopify.js","webpack:///external \"lodash\"","webpack:///external \"crypto\"","webpack:///external \"shopify-token\"","webpack:///external \"shopify-api-node\"","webpack:///external \"shopify-node-api\"","webpack:///external \"moment\"","webpack:///external \"dotenv\""],"names":["ENV","isProduction","isDebug","isClient","window","isTest","SCOPES","ACTIVATE_CHARGE_ROUTE","APP_NAME","APP_URL","APP_HOME_ROUTE","AUTH_CALLBACK_ROUTE","INSTALL_PAGE","UNINSTALL_ROUTE","sessionSecret","process","env","SESSION_SECRET","REDIS_URL","connect","Models","sequelize","session","config","db","dbUrl","use_env_variable","database","username","password","Shop","import","Object","keys","forEach","modelName","associate","port","PORT","set","server","createServer","listen","console","log","get","onError","error","syscall","bind","code","exit","onListening","addr","address","on","require","promise","options","promiseLib","query","e","pgp","connectionString","pdb","SHOPIFY_API_KEY","app","use","frameguard","action","domain","join","__dirname","rawBodySaver","req","res","buf","encoding","length","rawBody","toString","json","verify","urlencoded","extended","staticOptions","index","static","sessionConfig","resave","saveUninitialized","secret","proxy","name","cookie","httpOnly","secure","store","shopify","product","list","limit","then","status","products","next","shop","environment","SHOP_ORIGIN","readFile","err","content","replacement","result","replace","send","render","message","stack","authenticate","info","catch","DataTypes","define","type","STRING","unique","chargeId","BIGINT","classMethods","RedisStore","url","shopifyAPI","moment","router","Router","SHOPIFY_API_SECRET","getShopifyToken","sharedSecret","redirectUri","scopes","apiKey","getAppsHome","getEmbeddedAppHome","body","redirect","shopifyToken","nonce","generateNonce","state","shopName","split","decodeURI","generateAuthUrl","undefined","getShopifyApi","shopUrl","token","accessToken","afterShopifyAuth","webhook","topic","format","create","updateque","articleId","one","data","generateArticlesoShopify","blogId","title","time","time_format","articleContent","Shopify","post","response","headers","activeresponse","returnURL","postStatus","firsTimeAppcharges","dataReturn","application_charge","myObj","JSON","stringify","responseData","parse","confirmation_url","chargeCreatedresponse","statusAppcharges","returnUrl","chargeID","application_charges","item","chunkData","chunkedData","id","decorated_return_url","blogData","blogs","acceptedresponse","pendingresponse","shopify_api_key","shopify_shared_secret","shopify_scope","access_token","redirect_uri","shopurl","any","params","artId","parseInt","revStaus","revision","reason","obj","describe","contenType","productData","put","none","articleid","articleStaus","getAccessToken","findOrCreate","where","spread","verifyWebhookHMAC","hmac","digest","createHmac","update","destroy","authMiddleware","recurringApplicationCharge","charge_id","charge","activate","order","orders","checkActiveRecurringApplicationCharge","checkForValidSession"],"mappings":"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","file":"server.dev.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 039c469dfa172bfdb302","export const ENV = process.env.NODE_ENV || 'development';\nexport const isProduction = ENV === 'production';\nexport const isDebug = ENV === 'development';\nexport const isClient = typeof window !== 'undefined';\nexport const isTest = ENV === 'test';\n\nexport const SCOPES = 'read_orders,read_products, read_content, write_content';\nexport const ACTIVATE_CHARGE_ROUTE = '/activate_charge';\n\n/* export const APP_NAME = 'testapp999'; //Live */\nexport const APP_NAME = 'testapp999'; //Local dev\n/* export const APP_NAME = 'devapp999'; //local live */\n\nexport const APP_URL = 'https://65c8ef40.ngrok.io'; //Local dev\n\n/* export const APP_URL = 'https://84c4484d.ngrok.io'; //local live */\n\nexport const APP_HOME_ROUTE = '/home';\nexport const AUTH_CALLBACK_ROUTE = '/auth/callback';\nexport const INSTALL_PAGE = `https://apps.shopify.com/${APP_NAME}`;\nexport const UNINSTALL_ROUTE = '/uninstall';\n\nexport const sessionSecret =\n  process.env.SESSION_SECRET || 'Your Session Secret goes here';\n\nexport const REDIS_URL = process.env.REDIS_URL || 'redis://:@127.0.0.1:6379';\n\n\n\n// WEBPACK FOOTER //\n// ./server/config/index.js","module.exports = require(\"winston\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"winston\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 3\n// module chunks = 0","import connect from './connect';\nimport session from './session';\nimport { Models, sequelize } from './models';\n\nexport { connect, Models, sequelize, session };\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/index.js","import Sequelize from 'sequelize';\n\nimport { ENV } from '../../config';\nimport sequelizeConfig from '../sequelize_config.json';\nimport shopModel from './shop';\n\nconst config = sequelizeConfig[ENV];\n\nconst db = {};\n\nconst dbUrl = process.env[config.use_env_variable];\n\nconst { database, username, password } = config;\n\nconst sequelize = dbUrl\n  ? new Sequelize(dbUrl)\n  : new Sequelize(database, username, password, config);\n\ndb.Shop = sequelize.import('Shop', shopModel);\n\nObject.keys(db).forEach((modelName) => {\n  if (db[modelName].associate) {\n    db[modelName].associate(db);\n  }\n});\n\nexport { db as Models, sequelize };\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/models/index.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"pg-promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pg-promise\"\n// module id = 7\n// module chunks = 0","import http from 'http';\nimport app from './app';\n\n/**\n * Get port from environment and store in Express.\n */\nconst port = process.env.PORT || '3001';\napp.set('port', port);\n\n/**\n * Create HTTP server.\n */\nconst server = http.createServer(app);\n\n/**\n * Listen on provided port, on all network interfaces.\n */\nserver.listen(port);\n\nconsole.log('--------------------------');\nconsole.log('===> 😊  Starting Server . . .');\nconsole.log(`===>  Environment: ${process.env.NODE_ENV}`);\nconsole.log(`===>  Listening on port: ${app.get('port')}`);\nconsole.log('--------------------------');\n\n/**\n * Event listener for HTTP server \"error\" event.\n */\nfunction onError(error) {\n  if (error.syscall !== 'listen') {\n    throw error;\n  }\n\n  const bind = typeof port === 'string' ? `Pipe ${port}` : `Port ${port}`;\n\n  // handle specific listen errors with friendly messages\n  switch (error.code) {\n    case 'EACCES':\n      console.error(`${bind} requires elevated privileges`);\n      process.exit(1);\n      break;\n    case 'EADDRINUSE':\n      console.error(`${bind} is already in use`);\n      process.exit(1);\n      break;\n    default:\n      throw error;\n  }\n}\n\n/**\n * Event listener for HTTP server \"listening\" event.\n */\n\nfunction onListening() {\n  const addr = server.address();\n  const bind = typeof addr === 'string' ? `pipe ${addr}` : `port ${addr.port}`;\n  console.log(`Listening on ${bind}`);\n}\n\nserver.on('error', onError);\nserver.on('listening', onListening);\n\n\n\n// WEBPACK FOOTER //\n// ./server/server.js","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 9\n// module chunks = 0","import express from 'express';\nimport path from 'path';\n// import favicon from 'serve-favicon';\nimport cookieParser from 'cookie-parser';\nimport bodyParser from 'body-parser';\nimport flash from 'express-flash';\nimport fs from 'fs';\nimport methodOverride from 'method-override';\nimport gzip from 'compression';\nimport helmet from 'helmet';\nimport morgan from 'morgan';\nimport serialize from 'serialize-javascript';\nimport session from 'express-session';\nimport logger from 'winston';\n\nimport { APP_URL, ENV, isDebug, isProduction, sessionSecret } from './config';\n\nimport { connect, session as sessionStore } from './db';\n\nimport initShopify from './routes/shopify';\n\n// We configure dotenv as early as possible in the app\nrequire('dotenv').config();\n\n// Connect database\nconnect();\n\nvar promise = require('bluebird');\n\nvar options = {\n  promiseLib: promise,\n  query: e => {\n    console.log(e.query);\n  }\n};\n\nvar pgp = require('pg-promise')(options);\nvar connectionString = 'postgres://postgres:TechAdmin@localhost/shopify-app-development';\nvar pdb = pgp(connectionString);\n\n\n\n\nconst { SHOPIFY_API_KEY } = process.env;\n\nconst app = express();\n\nif (ENV === 'production') {\n  app.use(gzip());\n  // Secure your Express apps by setting various HTTP headers. Documentation: https://github.com/helmetjs/helmet\n  app.use(\n    helmet({\n      frameguard: {\n        action: 'allow-from',\n        domain: 'https://myshopify.com'\n      }\n    })\n  );\n}\n\nconst env = {\n  SHOPIFY_API_KEY\n};\n\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'pug');\n\n// app.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));\napp.use(morgan(isDebug ? 'dev' : 'combined'));\n\nconst rawBodySaver = (req, res, buf, encoding) => {\n  if (buf && buf.length) {\n    req.rawBody = buf.toString(encoding || 'utf8');\n  }\n};\n\napp.use(bodyParser.json({ verify: rawBodySaver }));\napp.use(bodyParser.urlencoded({ extended: false }));\n\napp.use(methodOverride());\napp.use(cookieParser());\n\nconst staticOptions = isProduction && { index: '_' };\napp.use(\n  express.static(path.join(__dirname, '../react-ui/build'), staticOptions)\n);\n\nconst sessionConfig = {\n  resave: false,\n  saveUninitialized: false,\n  secret: sessionSecret,\n  proxy: true, // The \"X-Forwarded-Proto\" header will be used.\n  name: 'sessionId',\n  // Add HTTPOnly, Secure attributes on Session Cookie\n  // If secure is set, and you access your site over HTTP, the cookie will not be set\n  cookie: {\n    httpOnly: true,\n    secure: ENV === 'production'\n  },\n  store: sessionStore\n};\n\napp.use(session(sessionConfig));\napp.use(flash());\n\napp.use('/', initShopify());\n\napp.get('/api/products', (req, res) => {\n  const { shopify } = req;\n\n  shopify.product.list({ limit: 5 }).then(products => {\n    res.status(200).json(products);\n  });\n});\n\n\n\n\n/* app.get('/api/appcharges', function (req, res) {\n  var shopify = req.shopify;\n  console.log(dbcon);\n   const query = client.query('SELECT * FROM blogList'); \n  res.status(200).json(shopify);\n}); */\n\n\napp.get('*', (req, res, next) => {\n  const { shop } = req.session.shopify || {};\n\n  const environment = { ...env, SHOP_ORIGIN: shop };\n\n  fs.readFile(\n    path.join(__dirname, '../react-ui/build/index.html'),\n    'utf8',\n    (err, content) => {\n      if (err) {\n        return next(err);\n      }\n\n      // Inject environment variables (Shopify API key and shop) in client code,\n      // to be usd by the embedded app\n      const replacement = `window.env = ${serialize(environment)}`;\n      const result = content.replace('var __ENVIRONMENT__', replacement);\n      return res.send(result);\n    }\n  );\n});\n\n// eslint-disable-next-line no-unused-vars\napp.use((err, req, res, next) => {\n  logger.error(err);\n  const status = err.status || 500;\n\n  res.status(status);\n  res.render(`${status}`, {\n    message: err.message,\n    error: isDebug && err.stack,\n    APP_URL\n  });\n});\n\nexport default app;\n\n\n\n// WEBPACK FOOTER //\n// ./server/app.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"express-flash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-flash\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"method-override\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"method-override\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helmet\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"morgan\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"serialize-javascript\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"serialize-javascript\"\n// module id = 20\n// module chunks = 0","import logger from 'winston';\nimport { sequelize } from './models';\n\nexport default () => {\n  sequelize\n    .authenticate()\n    .then(() => {\n      logger.info('Connection has been established successfully.');\n    })\n    .catch((err) => {\n      logger.error('Unable to connect to the database:', err);\n    });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/connect.js","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 22\n// module chunks = 0","module.exports = {\"development\":{\"username\":\"postgres\",\"password\":\"TechAdmin\",\"database\":\"shopify-app-development\",\"host\":\"127.0.0.1\",\"dialect\":\"postgres\"},\"test\":{\"username\":\"postgres\",\"password\":\"TechAdmin\",\"database\":\"shopify-app-test\",\"host\":\"127.0.0.1\",\"dialect\":\"postgres\",\"logging\":false},\"production\":{\"use_env_variable\":\"postgres://lscbefdvgkkhho:5d5e622a66aa9345ac0120284caca5f4351d3c024497c2a8cd031dc55709fbe7@ec2-23-21-121-220.compute-1.amazonaws.com:5432/d88e3905stiaec\",\"username\":\"lscbefdvgkkhho\",\"password\":\"5d5e622a66aa9345ac0120284caca5f4351d3c024497c2a8cd031dc55709fbe7\",\"database\":\"d88e3905stiaec\",\"host\":\"ec2-23-21-121-220.compute-1.amazonaws.com\",\"dialect\":\"postgres\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/db/sequelize_config.json\n// module id = 23\n// module chunks = 0","export default (sequelize, DataTypes) => {\n  const Shop = sequelize.define(\n    'Shop',\n    {\n      domain: {\n        type: DataTypes.STRING,\n        unique: true\n      },\n      chargeId: {\n        type: DataTypes.BIGINT,\n        unique: true\n      }\n    },\n    {\n      classMethods: {\n        associate() {\n          // associations can be defined here\n        }\n      }\n    }\n  );\n  return Shop;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/models/shop.js","import session from 'express-session';\nimport connectRedis from 'connect-redis';\n\nimport { isTest, REDIS_URL } from '../config';\n\nconst RedisStore = connectRedis(session);\n\nconst store = new RedisStore({\n  url: REDIS_URL,\n  // We use the 2nd database in Redis (1) in test to be able to clean it.\n  db: isTest ? 1 : 0,\n});\n\nstore.on('connect', () => {\n  console.log(`===> 😊  Connected to Redis Server on ${REDIS_URL}. . .`);\n});\n\nexport default store;\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/session.js","module.exports = require(\"connect-redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-redis\"\n// module id = 26\n// module chunks = 0","/**\n * Routes for express app\n */\nimport _ from 'lodash';\nimport crypto from 'crypto';\nimport express from 'express';\nimport ShopifyToken from 'shopify-token';\nimport ShopifyApi from 'shopify-api-node';\nimport logger from 'winston';\n\nvar shopifyAPI = require('shopify-node-api');\n\nvar promise = require('bluebird');\nvar moment = require('moment');\nvar options = {\n  // Initialization Options\n  promiseLib: promise,\n  query: e => {\n    console.log(e.query);\n  }\n};\n\nvar pgp = require('pg-promise')(options);\n\nvar connectionString = 'postgres://lscbefdvgkkhho:5d5e622a66aa9345ac0120284caca5f4351d3c024497c2a8cd031dc55709fbe7@ec2-23-21-121-220.compute-1.amazonaws.com:5432/d88e3905stiaec?ssl=true&sslfactory=org.postgresql.ssl.NonValidatingFactory';\n//var connectionString = 'postgres://lscbefdvgkkhho:5d5e622a66aa9345ac0120284caca5f4351d3c024497c2a8cd031dc55709fbe7@ec2-23-21-121-220.compute-1.amazonaws.com/d88e3905stiaec';\nvar pdb = pgp(connectionString);\n\n\n\nimport {\n  ACTIVATE_CHARGE_ROUTE,\n  APP_HOME_ROUTE,\n  APP_NAME,\n  APP_URL,\n  AUTH_CALLBACK_ROUTE,\n  INSTALL_PAGE,\n  SCOPES,\n  UNINSTALL_ROUTE\n} from '../config';\n\nimport { Models } from '../db';\n\nconst { Shop } = Models;\n\nconst router = express.Router();\n\nexport default () => {\n  const { SHOPIFY_API_KEY, SHOPIFY_API_SECRET } = process.env;\n\n  const getShopifyToken = () =>\n    new ShopifyToken({\n      sharedSecret: SHOPIFY_API_SECRET,\n      redirectUri: `${APP_URL}${AUTH_CALLBACK_ROUTE}`,\n      scopes: SCOPES,\n      apiKey: SHOPIFY_API_KEY\n    });\n\n  const getAppsHome = shop => `https://${shop}/admin/apps/`;\n\n  // The home page of the app in Shopify Admin\n  const getEmbeddedAppHome = shop => `${getAppsHome(shop)}${APP_NAME}`;\n\n  /**\n   * Authenticates the shop with Shopify when accessing protected routes.\n   * Returns a template file that redirects to the Shopify authorization page.\n   * This mechanism is used to authorize an embedded app.\n   * We need custom Javascript to escape the iframe as described in the docs.\n   * See the \"shopify_redirect\" template for details.\n   */\n  const authenticate = (req, res) => {\n    const { query, session } = req;\n\n    const shop = query.shop || req.body.shop;\n\n    logger.info('Authenticating shop %s', shop);\n\n    if (!shop) {\n      res.redirect(INSTALL_PAGE);\n      return;\n    }\n\n    const shopifyToken = getShopifyToken();\n    const nonce = shopifyToken.generateNonce();\n\n    // Save the nonce to state to verify it in the callback route later on\n    session.state = nonce;\n\n    const shopName = shop.split('.')[0];\n\n    const url = decodeURI(\n      shopifyToken.generateAuthUrl(shopName, undefined, nonce)\n    );\n\n    res.render('shopify_redirect', { url, shop });\n  };\n\n  /**\n   * Creates an interface for accessing the Shopify API.\n   * @param session A Shopify session with shop domain and access token\n   */\n  const getShopifyApi = session => {\n    const { shopify: { shop: shopUrl, token } } = session;\n\n    return new ShopifyApi({\n      shopName: shopUrl.split('.')[0],\n      accessToken: token\n    });\n  };\n\n  /**\n   * This method gets called when the app is installed.\n   * Setup any webhooks or services you need on Shopify inside here.\n   *\n   * @param session New session\n   */\n  const afterShopifyAuth = session => {\n    const shopify = getShopifyApi(session);\n\n    const webhook = {\n      topic: 'app/uninstalled',\n      address: `${APP_URL}${UNINSTALL_ROUTE}`,\n      format: 'json'\n    };\n\n    shopify.webhook.create(webhook);\n  };\n\n\n\nrouter.get('/api/appcharges', function (req, res, next) {\n\n    const shop = req.query.updateque; // $_GET[\"id\"]\n    const articleId = req.query.articleId; // $_GET[\"id\"]\n    if(shop){\n        pdb.one('select token from shopstoken where domain = $1', shop)\n        .then(function (data) {\n            if(data){\n\n                const token = data.token;\n\n               // const { session: { shopify: { shop, token } } } = req;\n                const shopifyToken = getShopifyToken();\n                const nonce = shopifyToken.generateNonce();\n\n                console.log(nonce);\n\n\n                var Shopify = new shopifyAPI({\n                  shop: shop, // MYSHOP.myshopify.com \n                  shopify_api_key: SHOPIFY_API_KEY, // Your API key \n                  shopify_shared_secret: SHOPIFY_API_SECRET, // Your Shared Secret \n                  shopify_scope: SCOPES,\n                  access_token: token,\n                  redirect_uri: `${APP_URL}`,\n                  nonce: nonce // you must provide a randomly selected value unique for each authorization request \n                });\n\n                console.log(Shopify);\n                \n                var application_charge = \n                {\n                    'application_charge':{\n                        \"name\": APP_NAME,\n                        \"price\": 100.0,\n                        \"return_url\": APP_URL,\n                        \"test\": true    \n                    }\n                };\n\n                var dataReturn  = '';\n                Shopify.get('/admin/application_charges.json', function(err, response, headers){  \n                    console.log('1 Step');\n                    var myObj = JSON.stringify(response);\n                    var responseData = JSON.parse(myObj);\n                    if(responseData.application_charges.length === 0){\n\n                        dataReturn = 'false';\n                        firsTimeAppcharges(dataReturn, shop, application_charge)\n                    }else{\n                        dataReturn = 'true';\n                        statusAppcharges(dataReturn, response, shop, application_charge);\n                    }\n                });\n\n                function generateArticlesoShopify(blogId, articleId, message, shop){\n\n                    pdb.one('select * from cparticle where articleid = $1', articleId)\n                        .then(function (data) {\n                            if(data){\n                                const title = data.title;\n                                const content = data.content;\n\n                                var time = moment();\n                                var time_format = time.format('YYYY-MM-DD HH:mm:ss Z');\n\n                                var articleContent = \n                                {\n                                    'article':{\n                                        \"title\": title,\n                                        \"author\": \"testapp999\",\n                                        \"tags\": \"This Post, Has Been Created by testapp999\",\n                                        \"body_html\": content,\n                                        \"published_at\": time_format,\n                                        \"published\": true\n                                    }\n                                };\n\n                                Shopify.post('/admin/blogs/'+blogId+'/articles.json', articleContent, function(err, response, headers, next){\n\n                                    let activeresponse = {\n                                        returnURL: `https://${shop}/admin/apps/${SHOPIFY_API_KEY}`,\n                                        message: message,\n                                        postStatus: 'success'\n                                    }\n\n                                    res.status(200).json(activeresponse);\n                                });\n                            }\n                        })\n                    .catch(function (err) {\n                        let activeresponse = {\n                            message: message,\n                            postStatus: 'Somwthing went wrong'\n                        }\n                        res.status(200).json(activeresponse);\n                    });\n                        \n                }\n\n\n                function firsTimeAppcharges(dataReturn, shop, application_charge){\n                    console.log('1 Enter');\n                    if(dataReturn == 'false'){\n                        Shopify.post('/admin/application_charges.json', application_charge, function(err, response, headers, next){\n                            console.log('2 Step');\n                            var myObj = JSON.stringify(response);\n                            var responseData = JSON.parse(myObj);\n                            var confirmation_url = responseData.application_charge.confirmation_url;\n\n                            let chargeCreatedresponse = {\n                                returnURL: confirmation_url,\n                                message: 'chargeCreated'\n                            }\n                            res.status(200).json(chargeCreatedresponse);                         \n                        });\n                    }            \n                }\n\n                function statusAppcharges(dataReturn, responseData, shop, application_charge){\n                    console.log('2 Enter');\n                    if(dataReturn == 'true'){\n                        var myObj = JSON.stringify(responseData);\n                        var responseData = JSON.parse(myObj);\n                        var returnUrl = '';\n                        var confirmation_url = '';\n                        var status = '';\n                        var chargeID = '';\n                        responseData.application_charges.forEach(function(item) {\n                            var chunkData = JSON.stringify(item);\n                            var chunkedData = JSON.parse(chunkData);\n\n                            console.log(chunkedData);\n                            confirmation_url = chunkedData.confirmation_url;\n                            status = chunkedData.status;\n                            chargeID = chunkedData.id;\n                            returnUrl = chunkedData.decorated_return_url;\n                        });\n\n                        console.log('TTTT: '+confirmation_url);\n                        if(status == 'active'){\n                            let activeresponse = {\n                                returnURL: `https://${shop}/admin/apps/${SHOPIFY_API_KEY}`,\n                                message: 'active',\n                                postStatus: 'Error 2'\n                            }\n                            Shopify.get('/admin/blogs.json', function(err, response, headers){\n                                console.log('3 Step');\n                                var chunkData = JSON.stringify(response);\n                                var blogData = JSON.parse(chunkData);\n                                let blogId = response.blogs[0].id;\n                                console.log(blogId);\n\n                                if(blogId && articleId){\n                                    let message = 'active';\n                                    generateArticlesoShopify(blogId, articleId, message, shop);\n                                }else{\n                                    res.status(200).json(activeresponse);    \n                                }\n                            });\n                        }\n                        else if(status == 'accepted'){\n                            var application_charge = \n                            {\n                                'application_charge':{\n                                    \"name\": APP_NAME,\n                                    \"status\": \"accepted\",\n                                    \"price\": 100.0,\n                                    \"return_url\": APP_HOME_ROUTE,\n                                    \"test\": true    \n                                }\n                            };\n                            Shopify.post('/admin/application_charges/'+chargeID+'/activate.json', application_charge, function(err, response, headers, next){\n                                console.log('4 Step');\n                                let acceptedresponse = {\n                                    returnURL: `https://${shop}/admin/apps/${SHOPIFY_API_KEY}`,\n                                    message: 'accepted',\n                                    postStatus: 'Error 3'\n                                }                                \n                                Shopify.get('/admin/blogs.json', function(err, response, headers){\n                                    var chunkData = JSON.stringify(response);\n                                    var blogData = JSON.parse(chunkData);\n                                    let blogId = response.blogs[0].id;\n                                    console.log(blogId);\n\n                                    if(blogId && articleId){\n                                        let message = 'accepted';\n                                        generateArticlesoShopify(blogId, articleId, message, shop);\n                                    }else{\n                                        res.status(200).json(activeresponse);    \n                                    }\n                                });\n                            });\n                        }\n                        else if(status == 'pending'){\n                            console.log('5 Step');\n                            let pendingresponse = {\n                                returnURL: confirmation_url,\n                                message: 'pending'\n                            }\n                            res.status(200).json(pendingresponse);\n                        }\n                        /*else if(status == 'declined'){\n                            console.log('6 Step');\n                            console.log(confirmation_url);\n\n                            let declinedresponse = {\n                                returnURL: confirmation_url,\n                               // returnURL: `https://${shop}/admin/apps/${SHOPIFY_API_KEY}`,\n                                message: 'declined'\n                            }\n                            res.status(200).json(declinedresponse);\n                        }*/\n                        \n                    }            \n                }\n\n\n            }                \n        })\n    }\n        \n}); \n\n\n/*getAllRequest*/\nrouter.get('/api/getarticles', (req, res) => {\n\n    const shop = req.query.updateque;\n    if(shop != 'all'){\n        const shopurl  = 'https://'+shop;\n        pdb.any('select * from bloglist where shopurl = $1', shopurl)\n        //pdb.any('select * from bloglist')\n        .then(function (data) {\n            res.status(200)\n              .json({\n                status: 'success',\n                data: data,\n                message: 'Retrieved article'\n              });\n          })\n        .catch(function (err) {\n            res.status(500)\n            .json({\n                status: 'error',\n                message: err\n            });\n        });\n    }else if(shop == 'all'){\n      const shopurl  = 'https://'+shop;\n      pdb.any('select * from bloglist')\n      .then(function (data) {\n          res.status(200)\n            .json({\n              status: 'success',\n              data: data,\n              message: 'Retrieved ALL articles'\n            });\n        })\n      .catch(function (err) {\n          res.status(500)\n          .json({\n              status: 'error',\n              message: err\n          });\n      });\n    }else{\n      res.status(500)\n      .json({\n          status: 'error',\n          message: 'Something went worng'\n      });\n    }\n    \n});\n\n/*get Single Request*/\nrouter.get('/api/getsinglearticles/:id', (req, res) => {\n    var id = req.params.id.replace(':', '');\n    var artId = parseInt(id);\n    console.log(artId);\n    var revStaus = 'true';\n    if(artId){\n    pdb.one('select revision from bloglist where revisionstatus=$1 AND id = $2', [ revStaus ,artId])\n    .then(function (data) {\n\n      res.status(200)\n        .json({\n          status: 'success',\n          data: data.revision,\n          message: 'Retrieved ONE puppy'\n        });\n    }, function (reason) {\n      console.log(reason); // print error;\n      //return next(reason);\n      res.status(200)\n        .json({\n          status: 'Error',\n          message: 'No data returned from the query.'\n        });\n    }).catch(function (err) {\n      res.status(200)\n        .json({\n          status: 'Error',\n          message: err\n        });\n    });\n    }\n});\n\n\n/*createRequest*/\nrouter.post('/api/newarticles', (req, res) => {  \n    var obj = req.body;\n    var time = moment();\n    var time_format = time.format('YYYY-MM-DD HH:mm:ss Z'); \n   // var describe = contenType = productData = shopUrl = '';\n    obj.data.forEach(function(item) {\n      console.log(item.shopurl);\n\n        const describe = item.describe;\n        const shopUrl = item.shopUrl;\n        const contenType = JSON.stringify(item.contenType);\n        const productData = JSON.stringify(item.productData);\n\n        if(shopUrl && describe && productData && contenType){\n          pdb.one(\"insert into bloglist(shopurl, describe, contenType, productData, createdat)\" +\n            \"values ($1, $2, $3, $4, $5)\"\n            +\"returning id\", [shopUrl, describe, contenType, productData, time])\n          .then(function (data) {\n              res.status(200)\n              .json({\n                status: 'success',\n                data: data,\n                message: 'Recivied ONE Entry'\n              });\n              \n          }, function (reason) {\n              //console.log('Insert into /locations failed for ', reason); // print error;\n              return next(reason);\n          });\n        }else{\n          res.status(404)\n          .json({\n            status: 'Error',\n            message: 'Fields are empty.'\n          });\n        }\n\n    });\n});\n\n\n/*updateRequest*/\nrouter.put('/api/updatearticles/:id', (req, res) => {  \n    var id = req.params.id.replace(':', '');\n    var obj = req.body;\n\n    pdb.none('update bloglist set revision=$1, revisionstatus=$2 where id=$3',\n    [obj.data, 'true', parseInt(id)])\n    .then(function (data) {\n        //console.log(obj.data); // print result;\n        res.status(200)\n        .json({\n            status: 'success',\n            message: 'Updated Request'\n        });\n    }, function (reason) {\n        console.log('Insert into /locations failed for ', reason); // print error;\n      //return next(reason);\n    })\n    .catch(function (err) {\n        res.status(500)\n        .json({\n            status: 'error',\n            message: err\n        });\n    });\n});\n\n\n/*getsingleArticle*/\nrouter.get('/api/article/:id', (req, res) => {\n  var id = req.params.id.replace(':', '');\n  var artId = parseInt(id);\n  console.log(artId);\n  if(artId){\n    pdb.one('select * from cparticle where articleid = $1', artId)\n    .then(function (data) {\n\n      res.status(200)\n        .json({\n          status: 'success',\n          data: data,\n          message: 'Retrieved ONE puppy'\n        });\n    }, function (reason) {\n      console.log(reason); // print error;\n      //return next(reason);\n      res.status(200)\n        .json({\n          status: 'Error',\n          message: 'No data returned from the query.'\n        });\n    }).catch(function (err) {\n      res.status(200)\n        .json({\n          status: 'Error',\n          message: err\n        });\n    });\n  }\n});\n\n\n/*generateArticle*/\nrouter.post('/api/generatearticle', (req, res) => {\n  var obj = req.body;\n  var time = moment();\n  var time_format = time.format('YYYY-MM-DD HH:mm:ss Z'); \n  \n  obj.data.forEach(function(item) {\n\n    const articleid = item.articleid;\n    const title = item.title;\n    const content = item.content;\n    var revStaus = 'false';\n    var articleStaus = 'true';\n\n    if(articleid && title && content){\n\n        pdb.one('select * from cparticle where articleid = $1', articleid)\n        .then(function (data) {\n\n            pdb.none('update cparticle set title=$1, content=$2, createdat=$3 where articleid=$4', \n                [title, content, time, parseInt(articleid)])\n            .then(function (data) {\n              \n              /*Update revisionstatus to false*/\n              pdb.none('update bloglist set revisionstatus=$1, articlestatus=$2 where id=$3',[revStaus, articleStaus, parseInt(articleid)])\n              .then(function (data) {/*console.log(data);*/ },\n              function (reason) {/*console.log(reason);*/ })\n              .catch(function (err) {});\n\n              res.status(200)\n              .json({\n                status: 'success',\n                data: data,\n                message: 'Recivied ONE Entry'\n              });\n              \n            }, function (reason) {\n              console.log('11TT: '+reason); // print error;\n              //return next(reason);\n            }).catch(function (err) {\n              res.status(404)\n              .json({\n                  status: 'Error',\n                  message: 'Fields are empty.'\n              });\n            });\n\n        }, function (reason) {\n          console.log(reason); // print error;\n\n          pdb.one(\"insert into cparticle(articleid, title, content, createdat)\" +\n          \"values ($1, $2, $3, $4)\"\n          +\"returning id\", [articleid, title, content, time])\n          .then(function (data) {\n            //console.log(obj); // print result;\n\n            /*Update revisionstatus to false*/\n            pdb.none('update bloglist set revisionstatus=$1, articlestatus=$2 where id=$3',[revStaus, articleStaus, parseInt(articleid)])\n            .then(function (data) {/*console.log(data);*/ },\n            function (reason) {/*console.log(reason);*/ })\n            .catch(function (err) {});\n\n            res.status(200)\n            .json({\n              status: 'success',\n              data: data,\n              message: 'Recivied ONE Entry'\n            });\n            \n          }, function (reason) {\n            console.log('22TT: '+reason); // print error;\n            //return next(reason);\n          }).catch(function (err) {\n            res.status(404)\n            .json({\n                status: 'Error',\n                message: 'Fields are empty.'\n            });\n          });\n          \n        }).catch(function (err) {\n          \n        });\n\n\n      \n    }else{\n      res.status(404)\n      .json({\n        status: 'Error',\n        message: 'Fields are empty.'\n      });\n    }\n\n  });\n});\n\n\n\n\n  /**\n   * Shopify calls this route after the merchant authorizes the app.\n   * It needs to match the callback route that you set in app settings.\n   */\n  router.get(AUTH_CALLBACK_ROUTE, (req, res, next) => {\n\n    console.log('Request: '+req);\n    const { query, session } = req;\n    const { code, shop, state } = query;\n    const shopifyToken = getShopifyToken();\n\n    // Exchange the authorization code for a permanent access token.\n    return shopifyToken\n      .getAccessToken(shop, code)\n      .then(token => {\n        session.shopify = { shop, token };\n\n        pdb.one('select token from shopstoken where domain = $1', shop)\n        .then(function (data) {\n            if(data){\n                pdb.one('delete from shopstoken where domain = $1', shop)\n                .then(function (result) {\n                }).catch(function (err) {\n                    pdb.one(\"insert into shopstoken(domain, token)\" +\n                      \"values ($1, $2)\"\n                      +\"returning id\", [shop, token])\n                    .then(function (data) {\n                        console.log(data);\n                    });\n                });\n\n            }                \n        })\n        .catch(function (err) {\n            pdb.one(\"insert into shopstoken(domain, token)\" +\n              \"values ($1, $2)\"\n              +\"returning id\", [shop, token])\n            .then(function (data) {\n                console.log(data);\n            });\n        });\n\n\n        return Shop.findOrCreate({\n          where: {\n            domain: shop\n          }\n        }).spread(() => {\n          afterShopifyAuth(session);\n          req.shopify = getShopifyApi(session);\n          return res.redirect('https://'+shop+'/admin/apps/'+SHOPIFY_API_KEY);\n        });\n      })\n      .catch(next);\n  });\n\n  const verifyWebhookHMAC = req => {\n    const hmac = req.headers['x-shopify-hmac-sha256'];\n\n    const digest = crypto\n      .createHmac('SHA256', SHOPIFY_API_SECRET)\n      .update(req.rawBody)\n      .digest('base64');\n\n    return digest === hmac;\n  };\n\n  /**\n   * This endpoint recieves the uninstall webhook and cleans up data.\n   * Add to this endpoint as your app stores more data. If you need to do a lot of work, return 200\n   * right away and queue it as a worker job.\n   */\n  router.post(UNINSTALL_ROUTE, (req, res) => {\n    if (!verifyWebhookHMAC(req)) {\n      res.status(401).send('Webhook HMAC Failed');\n      return;\n    }\n\n    Shop.destroy({\n      where: {\n        domain: req.headers['x-shopify-shop-domain']\n      }\n    }).then(() => {\n      res.status(200).send('Uninstalled');\n    });\n  });\n\n  /**\n   * This middleware checks if we have a session.\n   * If so, it attaches the Shopify API to the request object.\n   * If there is no session or we have a different shop,\n   * we start the authentication process.\n   */\n  const authMiddleware = (req, res, next) => {\n    logger.info(`Checking for valid session: ${req.query.shop}`);\n    const { session, query: { shop } } = req;\n\n    if (!session.shopify || (shop && session.shopify.shop !== shop)) {\n      delete session.shopify;\n      authenticate(req, res);\n      return;\n    }\n\n    req.shopify = getShopifyApi(session);\n    next();\n  };\n\n  router.use(authMiddleware);\n\n  /*\n   * Shopify calls this route when the merchant accepts or declines the charge.\n   */\n  router.get('/activate_charge', (req, res, next) => {\n    const {\n      shopify: { recurringApplicationCharge },\n      query: { charge_id: chargeId },\n      session: { shopify: { shop } }\n    } = req;\n\n    recurringApplicationCharge\n      .get(chargeId)\n      .then(charge => {\n        if (charge.status === 'accepted') {\n          return recurringApplicationCharge.activate(chargeId).then(() =>\n            // We redirect to the home page of the app in Shopify admin\n            res.redirect(getEmbeddedAppHome(shop))\n          );\n        }\n        res.status(401);\n        return res.render('charge_declined', { APP_URL });\n      })\n      .catch(next);\n  });\n\n  router.get('/logout', (req, res) => {\n    const { shop } = req.session.shopify;\n\n    delete req.session.shopify;\n\n    res.redirect(getAppsHome(shop));\n  });\n\n  router.get('/api/orders', (req, res) => {\n    const { shopify } = req;\n    console.log(shopify);\n\n    shopify.order.list({ limit: 5 }).then(orders => {\n      res.status(200).json(orders);\n    });\n  });\n\n  /**\n   * Checks if we have an active application charge.\n   * This middleware is active when the app is initially loaded.\n   */\n  const checkActiveRecurringApplicationCharge = (req, res, next) => {\n    logger.info(`Checking for active application charge: ${req.query.shop}`);\n    const { shopify } = req;\n    next();\n  };\n\n  /*\n   * Checks if the session is still valid by making a basic API call, as described in:\n   * https://stackoverflow.com/questions/14418415/shopify-how-can-i-handle-an-uninstall-followed-by-an-instant-re-install\n   */\n  const checkForValidSession = (req, res, next) => {\n    logger.info(`Checking if the session is still valid: ${req.query.shop}`);\n    const { session, shopify } = req;\n\n    return shopify.shop\n      .get()\n      .then(() => next())\n      .catch(() => {\n        // Destroy the Shopify reference\n        delete session.shopify;\n        authenticate(req, res);\n      });\n  };\n\n  router.get(\n    APP_HOME_ROUTE,\n    checkForValidSession,\n  //  checkActiveRecurringApplicationCharge,\n    (req, res) => {\n      res.redirect('/');\n    }\n  );\n\n  return router;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/shopify.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"shopify-token\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shopify-token\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"shopify-api-node\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shopify-api-node\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"shopify-node-api\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shopify-node-api\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 33\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 34\n// module chunks = 0"],"sourceRoot":""}